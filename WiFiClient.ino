#include <Wire.h>
#include <SPI.h>
#include <ArduinoJson.h>
#include <Adafruit_GFX.h>
#include <Adafruit_ssd1306syp.h>
#include <ESP8266WiFi.h>
#include "yahooWeather.h"
#include "asyncDelay.h"

static const unsigned char PROGMEM sunny[] ={B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000001, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B11100000, B00000001, B11000000, B00000011, B10000000, B00000001, B11110000, B00000000, B00000000, B00000111, B10000000, B00000001, B11111000, B00000000, B00000000, B00001111, B10000000, B00000000, B11111100, B00000000, B00000000, B00011111, B10000000, B00000000, B01111100, B00000000, B00000000, B00011111, B00000000, B00000000, B00111100, B00000011, B11000000, B00011110, B00000000, B00000000, B00011000, B00011111, B11111100, B00001000, B00000000, B00000000, B00000000, B01111111, B11111110, B00000000, B00000000, B00000000, B00000000, B11111111, B11111111, B10000000, B00000000, B00000000, B00000001, B11111111, B11111111, B10000000, B00000000, B00000000, B00000011, B11111000, B00001111, B11000000, B00000000, B00000000, B00000011, B11100000, B00000111, B11100000, B00000000, B00000000, B00000011, B11000000, B00000011, B11100000, B00000000, B00000000, B00000111, B11000000, B00000001, B11110000, B00000000, B00000000, B00000111, B10000000, B00000001, B11110000, B00000000, B00111111, B00000111, B10000000, B00000000, B11110000, B01111110, B01111111, B10000111, B10000000, B00000000, B11110000, B11111111, B01111111, B10000111, B10000000, B00000000, B11110000, B11111111, B01111111, B00000111, B10000000, B00000000, B11110000, B11111110, B00000000, B00000111, B10000000, B00000001, B11110000, B00000000, B00000000, B00000111, B11000000, B00000001, B11110000, B00000000, B00000000, B00000111, B11000000, B00000011, B11100000, B00000000, B00000000, B00000011, B11100000, B00000111, B11100000, B00000000, B00000000, B00000011, B11111000, B00001111, B11000000, B00000000, B00000000, B00000001, B11111110, B00111111, B11000000, B00000000, B00000000, B00000000, B11111111, B11111111, B10000000, B00000000, B00000000, B00000000, B01111111, B11111111, B00000000, B00000000, B00000000, B00000000, B00011111, B11111100, B00000000, B00000000, B00000000, B00111100, B00000111, B11100000, B00011110, B00000000, B00000000, B01111100, B00000000, B00000000, B00011111, B00000000, B00000000, B11111100, B00000000, B00000000, B00011111, B10000000, B00000001, B11111000, B00000000, B00000000, B00001111, B10000000, B00000001, B11110000, B00000000, B00000000, B00000111, B10000000, B00000000, B11100000, B00000001, B11000000, B00000011, B10000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000001, B11000000, B00000000, B00000000, B00000000, B00000000, B00000000, B10000000, B00000000, B00000000};
  static const unsigned char PROGMEM cloudy[] ={B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00110000, B00000000, B00000000, B00000000, B00000000, B00000000, B01110000, B00000000, B00000000, B00000000, B00000000, B00000000, B01111000, B00000000, B00000000, B00000000, B00000000, B00000000, B01111000, B00000000, B00000000, B00000000, B00000000, B00000000, B01111000, B00000000, B00000000, B00000000, B00000000, B00000000, B01111000, B00000000, B00000000, B00000000, B00000100, B00000000, B01110000, B00000000, B10000000, B00000000, B00001110, B00000000, B00110000, B00000011, B11000000, B00000000, B00011111, B00000000, B00000000, B00000111, B11000000, B00000000, B00001111, B10000000, B00000000, B00000111, B11000000, B00000000, B00001111, B10000000, B00000000, B00001111, B10000000, B00000000, B00000111, B11000000, B00000000, B00001111, B00000000, B00000000, B00000011, B10000001, B11111100, B00000110, B00000000, B00000000, B00000000, B00000111, B11111111, B00000000, B00000000, B00000000, B00000000, B00001111, B11111111, B11000000, B00000000, B00000000, B00000011, B00011111, B11111111, B11100000, B00000000, B00000000, B00111111, B11111111, B00000111, B11100000, B00000000, B00000000, B11111111, B11111110, B00000001, B11110000, B00000000, B00000001, B11111111, B11111110, B00000000, B11110000, B00000000, B00000111, B11111111, B11111111, B00000000, B11111000, B00000000, B00001111, B11100000, B00111111, B10000000, B01111000, B00000000, B00001111, B10000000, B00001111, B11000000, B01111000, B00111100, B00011111, B00000000, B00000111, B11000000, B01111000, B01111110, B00111110, B00000000, B00000011, B11111100, B01111000, B01111111, B00111100, B00000000, B00000001, B11111111, B11111000, B01111110, B00111100, B00000000, B00000001, B11111111, B11111000, B00111100, B01111000, B00000000, B00000000, B11111111, B11111000, B00000000, B01111000, B00000000, B00000000, B11111111, B11111000, B00000000, B01111000, B00000000, B00000000, B00000000, B11111000, B00000000, B01110000, B00000000, B00000000, B00000000, B01111100, B00000000, B01110000, B00000000, B00000000, B00000000, B00111100, B00000000, B01110000, B00000000, B00000000, B00000000, B00111110, B00000000, B01110000, B00000000, B00000000, B00000000, B00011110, B00000000, B01111000, B00000000, B00000000, B00000000, B00011110, B00000000, B01111000, B00000000, B00000000, B00000000, B00011110, B00000000, B01111000, B00000000, B00000000, B00000000, B00011110, B00000000, B01111100, B00000000, B00000000, B00000000, B00011110, B00000000, B00111100, B00000000, B00000000, B00000000, B00011110, B00000000, B00111110, B00000000, B00000000, B00000000, B00011110, B00000000, B00011110, B00000000, B00000000, B00000000, B00111100, B00000000, B00011111, B10000000, B00000000, B00000000, B01111100, B00000000, B00001111, B11000000, B00000000, B00000000, B11111100, B00000000, B00000111, B11111000, B00000000, B00000011, B11111000, B00000000, B00000011, B11111111, B11111111, B11111111, B11110000, B00000000, B00000001, B11111111, B11111111, B11111111, B11100000, B00000000, B00000000, B01111111, B11111111, B11111111, B11000000, B00000000, B00000000, B00011111, B11111111, B11111111, B00000000, B00000000};
  static const unsigned char PROGMEM rain[] ={B00000000, B00000011, B11111000, B00000000, B00000000, B00000000, B00000000, B00011111, B11111111, B00000000, B00000000, B00000000, B00000000, B01111111, B11111111, B11000000, B00000000, B00000000, B00000001, B11111111, B11111111, B11110000, B00000000, B00000000, B00000011, B11111111, B11111111, B11111000, B00000000, B00000000, B00000111, B11111100, B00000111, B11111100, B00000000, B00000000, B00001111, B11110000, B00000001, B11111110, B00000000, B00000000, B00011111, B11000000, B00000000, B01111111, B00000000, B00000000, B00011111, B10000000, B00000000, B00111111, B00000000, B00000000, B00111111, B00000000, B00000000, B00011111, B11111110, B00000000, B01111110, B00000000, B00000000, B00001111, B11111111, B10000000, B01111100, B00000000, B00000000, B00001111, B11111111, B11100000, B01111100, B00000000, B00000000, B00000111, B11111111, B11110000, B11111000, B00000000, B00000000, B00000111, B11001111, B11111000, B11111000, B00000000, B00000000, B00000000, B00000011, B11111000, B11111000, B00000000, B00000000, B00000000, B00000000, B11111100, B11111000, B00000000, B00000000, B00000000, B00000000, B01111110, B11111000, B00000000, B00000000, B00000000, B00000000, B00111110, B11111000, B00000000, B00000000, B00000000, B00000000, B00111110, B11111000, B00000000, B00000000, B00000000, B00000000, B00011111, B11111000, B00000000, B00000000, B00000000, B00000000, B00011111, B11111000, B00000000, B00000000, B00000000, B00000000, B00011111, B01111100, B00000011, B10000000, B00000001, B11000000, B00011111, B01111100, B00000111, B10000000, B00000011, B11100000, B00011111, B01111110, B00000111, B11000000, B00000011, B11100000, B00011111, B00111111, B00000111, B11000000, B00000011, B11100000, B00111110, B00111111, B00000111, B11000001, B10000011, B11100000, B00111110, B00011111, B10000111, B11000011, B11000011, B11100000, B01111110, B00001111, B10000111, B11000011, B11000011, B11100000, B11111100, B00000111, B10000111, B10000011, B11000001, B11100001, B11111000, B00000011, B10000001, B00000011, B11000000, B10000001, B11111000, B00000001, B10000000, B00000011, B11000000, B00000001, B11110000, B00000000, B00000000, B00000011, B11000000, B00000001, B11100000, B00000000, B00000000, B00000011, B11000000, B00000001, B10000000, B00000000, B00000000, B00000011, B10000000, B00000000, B00000000, B00000000, B00000011, B10000000, B00000001, B11000000, B00000000, B00000000, B00000111, B10000000, B00000011, B11100000, B00000000, B00000000, B00000111, B11000000, B00000011, B11100000, B00000000, B00000000, B00000111, B11000000, B00000011, B11100000, B00000000, B00000000, B00000111, B11000001, B10000011, B11100000, B00000000, B00000000, B00000111, B11000011, B11000011, B11100000, B00000000, B00000000, B00000111, B10000011, B11000011, B11100000, B00000000, B00000000, B00000111, B10000011, B11000001, B11000000, B00000000, B00000000, B00000001, B00000011, B11000000, B10000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B10000000, B00000000, B00000000};
  static const unsigned char PROGMEM thunder[] ={B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11111100, B00000000, B00000000, B00000000, B00000000, B00011111, B11111111, B10000000, B00000000, B00000000, B00000000, B01111111, B11111111, B11100000, B00000000, B00000000, B00000000, B11111111, B11111111, B11110000, B00000000, B00000000, B00000001, B11111111, B11111111, B11111000, B00000000, B00000000, B00000011, B11111100, B00000011, B11111100, B00000000, B00000000, B00000111, B11110000, B00000000, B11111110, B00000000, B00000000, B00001111, B11000000, B00000000, B00111111, B00000000, B00000000, B00011111, B10000000, B00000000, B00011111, B10000000, B00000000, B00011111, B00000000, B00000000, B00001111, B11111111, B00000000, B00111111, B00000000, B00000000, B00001111, B11111111, B11000000, B00111110, B00000000, B00000000, B00000111, B11111111, B11100000, B00111110, B00000000, B00000000, B00000111, B11111111, B11110000, B01111100, B00000000, B00000000, B00000011, B00000111, B11111000, B01111100, B00000000, B00000000, B00000000, B00000001, B11111100, B01111100, B00000000, B00000000, B00000000, B00000000, B11111100, B01111100, B00000000, B00000000, B00000000, B00000000, B01111110, B01111100, B00000000, B00000000, B00000000, B00000000, B00111110, B01111100, B00000000, B00000000, B00000000, B00000000, B00111110, B01111100, B00000000, B00000011, B11111111, B00000000, B00011111, B01111100, B00000000, B00000111, B11111111, B00000000, B00011111, B00111100, B00000000, B00000111, B11111111, B00000000, B00011111, B00111110, B00000000, B00000111, B11111110, B00000000, B00011111, B00111111, B00000000, B00001111, B11111100, B00000000, B00011111, B00011111, B00000000, B00001111, B11111100, B00000000, B00111110, B00011111, B10000000, B00001111, B11111000, B00000000, B00111110, B00001111, B11000000, B00011111, B11111000, B00000000, B01111110, B00000111, B11110000, B00011111, B11110000, B00000000, B11111100, B00000111, B11111100, B00011111, B11100000, B00000011, B11111000, B00000011, B11111100, B00111111, B11111111, B00000111, B11111000, B00000000, B11111100, B00111111, B11111111, B10001111, B11110000, B00000000, B01111100, B00111111, B11111111, B10011111, B11100000, B00000000, B00011000, B01111111, B11111111, B00011111, B10000000, B00000000, B00000000, B01111111, B11111110, B00111100, B00000000, B00000000, B00000000, B00000001, B11111100, B00000000, B00000000, B00000000, B00000000, B00000001, B11111000, B00000000, B00000000, B00000000, B00000000, B00000001, B11111000, B00000000, B00000000, B00000000, B00000000, B00000001, B11110000, B00000000, B00000000, B00000000, B00000000, B00000011, B11100000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B10000000, B00000000, B00000000, B00000000, B00000000, B00000111, B00000000, B00000000, B00000000, B00000000, B00000000, B00000111, B00000000, B00000000, B00000000, B00000000, B00000000, B00000110, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000};
  static const unsigned char PROGMEM breezy[] ={B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00011111, B11000000, B00000000, B00000000, B00000000, B00000000, B11111111, B11110000, B00000000, B00000000, B00000000, B00000001, B11111111, B11111100, B00000000, B00000000, B00000000, B00000111, B11111111, B11111110, B00000000, B00000000, B00000000, B00001111, B11111000, B11111111, B00000000, B00000000, B00000000, B00001111, B11000000, B00011111, B10000000, B00000000, B00000000, B00011111, B00000000, B00001111, B11000000, B00000000, B00000000, B00111110, B00000000, B00000111, B11000000, B00000000, B00000000, B00111100, B00000000, B00000011, B11111111, B00000000, B00000000, B01111100, B00000000, B00000001, B11111111, B11000000, B00000000, B01111000, B00000000, B00000001, B11111111, B11100000, B00000000, B01111000, B00000000, B00000000, B11111111, B11110000, B00000000, B11110000, B00000000, B00000000, B11000011, B11111000, B00000000, B11110000, B00000000, B00000000, B00000000, B11111000, B00000000, B11110000, B00000000, B00000000, B00000000, B01111100, B00000000, B11110000, B00000000, B00000000, B00000000, B00111100, B00000000, B11110000, B00000000, B00000000, B00000000, B00001100, B00000000, B11110000, B00000000, B00000000, B00000000, B00000000, B00000000, B11110000, B00000000, B00000000, B00000000, B00000000, B00000000, B01111000, B00000000, B00000000, B00000000, B00000000, B00000000, B01111000, B00000000, B00000000, B00000000, B11110000, B00000000, B01111000, B00000000, B00000000, B00000000, B11111000, B00000000, B00111100, B00000000, B00000000, B00000000, B11111100, B00000000, B00111110, B00000000, B00000000, B00000000, B01111100, B00000000, B00011111, B00000000, B00000000, B00000000, B00111110, B01111000, B00011111, B10000000, B00000000, B00000000, B00011110, B11111100, B00001111, B11100000, B00000000, B00000000, B00111110, B11111110, B00000111, B11111111, B11111111, B11111111, B11111100, B00111110, B00000011, B11111111, B11111111, B11111111, B11111100, B00011110, B00000000, B11111111, B11111111, B11111111, B11111000, B00001110, B00000000, B01111111, B11111111, B11111111, B11110000, B00011110, B00000000, B01111111, B11111111, B11111111, B11000001, B11111110, B00000000, B01111000, B00000000, B00000000, B00000011, B11111110, B00000000, B01111000, B00000000, B00000000, B00000011, B11111100, B00000000, B01111000, B00000000, B00000000, B00000011, B11111000, B00000000, B01111111, B11111111, B11111111, B11100000, B00000000, B00000000, B00111111, B11111111, B11111111, B11111000, B00000000, B00000000, B00011111, B11111111, B11111111, B11111100, B00000000, B00000000, B00001111, B11111111, B11111111, B11111100, B00000000, B00000000, B00000000, B00000000, B00000000, B00111110, B00000000, B00000000, B00000000, B00000000, B00000000, B00011110, B00000000, B00000000, B00000000, B00000000, B00000000, B00011110, B00000000, B00000000, B00000000, B00000000, B00000000, B00111110, B00000000, B00000000, B00000000, B00000000, B00000000, B11111100, B00000000, B00000000, B00000000, B00000000, B00000000, B11111100, B00000000, B00000000, B00000000, B00000000, B00000000, B11111000, B00000000, B00000000, B00000000, B00000000, B00000000, B11110000, B00000000};
static const unsigned char PROGMEM sunset[] ={B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000001, B11000000, B00000011, B11000000, B00000011, B10000000, B00000011, B11100000, B00000000, B00000000, B00000111, B11000000, B00000001, B11110000, B00000000, B00000000, B00001111, B10000000, B00000001, B11111000, B00000000, B00000000, B00011111, B10000000, B00000000, B11111000, B00000000, B00000000, B00011111, B00000000, B00000000, B01111000, B00000011, B11000000, B00011110, B00000000, B00000000, B00110000, B00011111, B11111000, B00001100, B00000000, B00000000, B00000000, B01111111, B11111110, B00000000, B00000000, B00000000, B00000000, B11111111, B11111111, B00000000, B00000000, B00000000, B00000001, B11111111, B11111111, B10000000, B00000000, B00000000, B00000011, B11111000, B00011111, B11000000, B00000000, B00000000, B00000111, B11100000, B00000111, B11100000, B00000000, B00000000, B00000111, B11000000, B00000011, B11100000, B00000000, B00000000, B00000111, B10000000, B00000001, B11100000, B00000000, B00000000, B00001111, B10000001, B10000001, B11110000, B00000000, B00111100, B00001111, B10000001, B10000001, B11110000, B00111100, B11111111, B00001111, B00011101, B10111000, B11110000, B11111111, B11111111, B00001111, B00011111, B11111000, B11110000, B11111111, B11111111, B00001111, B00001111, B11110000, B11110000, B11111111, B00011000, B00001111, B10000111, B11100001, B11110000, B00011000, B00000000, B00001111, B10000011, B11000001, B11110000, B00000000, B00000000, B00000111, B10000001, B10000000, B11100000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000111, B11111111, B11111111, B11100000, B00000000, B00000000, B00001111, B11111111, B11111111, B11110000, B00000000, B00000000, B00001111, B11111111, B11111111, B11110000, B00000000, B00000000, B00001111, B11111111, B11111111, B11110000, B00000000, B00000000, B00000011, B11111111, B11111111, B11100000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000};
static const unsigned char PROGMEM dawn[] ={B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000001, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11000000, B00000000, B00000000, B00000001, B11000000, B00000001, B11000000, B00000011, B10000000, B00000001, B11100000, B00000000, B00000000, B00000111, B11000000, B00000001, B11110000, B00000000, B00000000, B00001111, B11000000, B00000001, B11111000, B00000000, B00000000, B00011111, B10000000, B00000000, B11111100, B00000000, B00000000, B00011111, B00000000, B00000000, B01111000, B00000011, B11000000, B00011110, B00000000, B00000000, B00011000, B00011111, B11111100, B00001100, B00000000, B00000000, B00000000, B01111111, B11111110, B00000000, B00000000, B00000000, B00000000, B11111111, B11111111, B00000000, B00000000, B00000000, B00000001, B11111111, B11111111, B10000000, B00000000, B00000000, B00000011, B11111000, B00011111, B11000000, B00000000, B00000000, B00000011, B11110000, B00000111, B11100000, B00000000, B00000000, B00000111, B11000000, B00000011, B11100000, B00000000, B00000000, B00000111, B11000000, B10000001, B11110000, B00000000, B00000000, B00001111, B10000001, B11000001, B11110000, B00000000, B00111110, B00001111, B10000011, B11100000, B11110000, B00111100, B11111111, B00001111, B10001111, B11110000, B11110000, B01111111, B11111111, B00001111, B10001111, B11111000, B11110000, B11111111, B11111111, B00001111, B10011101, B11111000, B11110000, B01111111, B00011100, B00001111, B10000001, B10000000, B11110000, B00011000, B00000000, B00000111, B10000001, B10000001, B11110000, B00000000, B00000000, B00000111, B10000000, B10000000, B11100000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000011, B11111111, B11111111, B11100000, B00000000, B00000000, B00001111, B11111111, B11111111, B11110000, B00000000, B00000000, B00001111, B11111111, B11111111, B11110000, B00000000, B00000000, B00000111, B11111111, B11111111, B11110000, B00000000, B00000000, B00000011, B11111111, B11111111, B11100000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000, B00000000};

const int iconSize = 48;

const int SDA_PIN=D1;
const int SCL_PIN=D2;

const char* ssid     = "ssidname";
const char* password = "password";

Adafruit_ssd1306syp display(SDA_PIN, SCL_PIN);

yahooWeather myW = yahooWeather();

void renderTitle(int x,int y){    
    display.clear();
    display.setCursor(x,y);
    display.println("Title");
    display.update();
}

void setup(){
    display.initialize();
    for(int i=0; i>0; i--){
      delay(5);
      renderTitle(0,i);
    }
    delay(1000);
    for(int i=0; i>-64; i--){
      delay(5);
      renderTitle(0,i);
    }
    WiFi.begin(ssid, password);
    Serial.begin(115200);
    while(WiFi.status()!=WL_CONNECTED){
      delay(500);
      Serial.print('.');
    }
    WiFiClient client;    
    Serial.println("connected");
    myW.Start(client,100);
    Serial.println("started");
}
int n=0;

struct view{ int y; String date; int temp; String text;String day;String type;String time; };

view currentView;


// TODO: create a class for handling views
void getData(){
 if(n>7) n=0;
 String json = myW.getData();  
  DynamicJsonBuffer  jsonBuffer;
  JsonObject& root = jsonBuffer.parseObject(json);  
  if (!root.success()) {
      Serial.println("parseObject() failed");          
  } else{
      view nextView;  
      nextView.y = display.height();
		if(n<=5){
			JsonObject& forecast = root["query"]["results"]["channel"]["item"]["forecast"][n];                  
			String date = forecast["date"];
			String text = forecast["text"];
			String day = forecast["day"];
			nextView.type = "forecast";
			nextView.date = date;    
			nextView.text = text;
			nextView.day = day;
		}else if(n==6){
			nextView.time = "00:00:00";
			nextView.type="ss";
		}else if(n==7){
			nextView.time = "00:00:00";
			nextView.type="sd";
		}
		      handleView(nextView); 
    
    n++;  
  }
}


// TODO: create a class for handling views

void handleView(struct view newView){
  Serial.println(newView.type);
  for(currentView.y; currentView.y > -display.height() ; currentView.y-=2){
    delay(5);
      renderV(currentView);  
  }
  for(newView.y; newView.y>0;newView.y-=2){    
    delay(5);
    renderV(newView);
  }
  currentView = newView;
}


void renderV(struct view v){  
  String s = v.text;
  s.toLowerCase();
  display.clear();
  if(v.type=="forecast"){
      display.setCursor(0,v.y);
      display.setTextSize(1);
      display.println(v.date);
      display.println();
      display.setTextSize(2);
      display.println(v.day);
      display.println();
      display.setTextSize(1);
      display.println(v.text);
      display.println();
      if(s.indexOf("sun")>=0 || s.indexOf("sunny")>=0){
        display.drawBitmap(display.width()-iconSize,v.y+10,sunny,iconSize,iconSize,WHITE);  
      }else if(s.indexOf("cloudy")>=0){
        display.drawBitmap(display.width()-iconSize,v.y+10,cloudy,iconSize,iconSize,WHITE);  
      }else if(s.indexOf("rain")>=0){
        display.drawBitmap(display.width()-iconSize,v.y+10,rain,iconSize,iconSize,WHITE);  
      }else if(s.indexOf("thunderstorms")>=0){
        display.drawBitmap(display.width()-iconSize,v.y+10,thunder,iconSize,iconSize,WHITE);  
      }else if(s.indexOf("breezy")>=0 ){
        display.drawBitmap(display.width()-iconSize,v.y+10,breezy,iconSize,iconSize,WHITE);  
      }  
  }
  display.setTextSize(1);
  if(v.type=="ss"){
    display.drawBitmap((display.width()/2)-(iconSize/2),v.y+0,sunset,iconSize,iconSize,WHITE);  
    display.setCursor(0,v.y+50);
    display.println(v.time);
  }else if(v.type=="sd"){
    display.drawBitmap((display.width()/2)-(iconSize/2),v.y+0,dawn,iconSize,iconSize,WHITE);  
    display.setCursor(0,v.y+50);
    display.println(v.time);
  }
  display.update();
}


asyncDelay b = asyncDelay(5000);
void loop(){
  delay(500);  
  b.runJob(&getData);
}  

